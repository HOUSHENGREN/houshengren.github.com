(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{407:function(n,s,e){"use strict";e.r(s);var a=e(2),t=Object(a.a)({},(function(){var n=this,s=n._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[s("h2",{attrs:{id:"自定义指令的概念理解"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#自定义指令的概念理解"}},[n._v("#")]),n._v(" 自定义指令的概念理解")]),n._v(" "),s("p",[n._v("vue2指令有四个钩子函数，分别是inserted、update、componentUpdated、bind、unbind。官方的解释有点不大好理解，我类比一下，大家就容易懂了。")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("inserted => mounted\nbind => created\nunbind => beforeDestroy\nupdate => 当前节点更新时\ncomponentUpdated => 当前节点及其子节点全部更新完成时调用\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br")])]),s("p",[n._v("五个函数分别可接受el、binding、vnode、oldVnode四个入参，oldVnode是只有update、componentUpdated函数才有的入参。")]),n._v(" "),s("p",[n._v("vnode.context，可以拿到当前组件实例，v-model底层实现就是利用了这个去修改当前实例的参数。")]),n._v(" "),s("h2",{attrs:{id:"v-mymodel的实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#v-mymodel的实现"}},[n._v("#")]),n._v(" v-myModel的实现")]),n._v(" "),s("p",[n._v("以下来实现一下双向绑定，只考虑input，不考虑其他表单组件")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("<template>\n  <input v-myModel=\"input\" />\n</template>\n\n<script>\nexport default {\n  name: 'App',\n  directives: {\n    myModel: {\n      bind(el, binding, vnode) {\n        console.log('kjlkkj', binding.value);\n        el.value = binding.value;\n        el.addEventListener('input', function () {\n          vnode.context[binding.expression] = this.value;\n        });\n      },\n      update(el, binding) {\n        el.value = binding.value;\n      },\n    },\n  },\n  data() {\n    return {\n      input: '222',\n    };\n  },\n};\n<\/script>\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br")])]),s("p",[n._v("指令还分全局与局部，只是注册的位置不同，此处省略。")]),n._v(" "),s("p",[n._v("我多举几个常用的例子。")]),n._v(" "),s("h2",{attrs:{id:"v-permission的实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#v-permission的实现"}},[n._v("#")]),n._v(" v-permission的实现")]),n._v(" "),s("p",[n._v("实现v-permission指令。实现这一指令，可以在用户登录时，请求一次用户的权限fetchPermissions，存到localstorage，这样就方便指令去拿权限信息了。绑定的指令先判断当前绑定权限是否包含，没有则隐藏，当然处理隐藏还可以做其它处理，比如禁止点击。另外，绑定的值的类型可以做个判断，兼容下，传入数组的情况。")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("permisson: {\n  inserted(el, binding) {\n    let val = binding.value\n    if(binding.value) {\n      // 这里的用户权限是从接口返回\n      let fetchPermissions = ['add', 'delete', 'fix']\n      let hasPer = fetchPermissions.some(i => i === val)\n      // 没权限则隐藏\n      if(!hasPer) el.style.display = 'none'\n    }\n  }\n}\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br")])]),s("h2",{attrs:{id:"v-empty的实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#v-empty的实现"}},[n._v("#")]),n._v(" v-empty的实现")]),n._v(" "),s("p",[n._v("实现v-empty指令，假设需要接受图片地址、文字信息，这样我们就需要创建跟真实节点插入到当前节点，那么这个要怎么创建真实节点呢？在vue2里面可以借助Vue.extend()得到vue组件，在利用$mount().$el()得到真实节点。明白了这点，下面我们来实现一遍。")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("empty: {\n  update(el, binding, vnode) {\n    // 子绝父相 + 居中\n    el.style.position = el.style.position || 'relative'\n    const { offsetHeight, offsetWidth } = el\n    const { visible, content, img } = binding.value\n    const image = img ? `<img src=\"${img}\" height='30%' width=\"30%\"/>` : ''\n    const defaultStyle = \"position: absolute;top:0;left:0;z-index:9999;background:#fff;display:flex;align-items:center;justify-content:center;\"\n    const empty = Vue.extend({\n      template: `<div style='height: ${offsetHeight}px;width:${offsetWidth}px;${defaultStyle}'>\n        <div style='text-align:center'>\n          <div>\n            ${image}\n          </div>\n          <div>\n            ${content || '暂无数据'}\n          </div>\n        </div>\n      </div>\n      `\n    })\n    const component = new empty().$mount().$el\n    visible ? el.appendChild(component) : el.removeChild(el.lastChild)\n  }\n}\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br")])]),s("p",[n._v("删除子元素使用了"),s("code",[n._v("el.removeChild(el.lastChild)")]),n._v("，不会有太大问题，当前节点下只可能是我传入的img节点。这里要更严谨点，可能innerHtml = ''更好。实际使用时，优化下即可。")]),n._v(" "),s("h2",{attrs:{id:"v-preventreclick的实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#v-preventreclick的实现"}},[n._v("#")]),n._v(" v-preventReClick的实现")]),n._v(" "),s("p",[n._v("该指令的作用是为了防止频繁点击按钮导致请求频繁，优化下，可以做成类似于防抖/节流的功能。根据当前按钮是否disabled来决定是否让用户能点击。")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("preventReClick: {\n  inserted(el, binding, vnode) {\n    el.addEventListener('click', function() {\n      if(!el.disabled) {\n        el.disabled = true\n        setTimeout(() => { el.disabled = false }, binding.value || 2000)\n      }\n    })\n  }\n}\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br")])]),s("h2",{attrs:{id:"结语"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#结语"}},[n._v("#")]),n._v(" 结语")]),n._v(" "),s("p",[n._v("vue指令的更多实现，可参考"),s("a",{attrs:{href:"https://gesj-yean.github.io/vue-demo-collection/base/directive/empty.html",target:"_blank",rel:"noopener noreferrer"}},[n._v("Vue-Demo-Collection"),s("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=t.exports}}]);